#!/usr/bin/env python
""" utilities.py
Utility functions
"""
import numpy as np
from pandas import DataFrame

from .datafeed import IntradayQuotes
from datetime import date

def get_raw_data(ticker, start=date(1900, 01, 01), end=date.today()):
    """ Generate an array of quotes and indicators for the given stock
    :param ticker: Ticker of the security to quote.
    :param start: (Optional) Start of date range to get.
    :param end: (Optional) End of date range to get.
    :returns: tuple containing (raw data, ticker_and_date_info)
   """
    # Get quotes
    quotes = IntradayQuotes().get_quotes(ticker, start, end)

    # Generate matrix
    col_names = [
              'weekday',
              'adj_close',
              'Volume',
              'ma_5_day',
              'ma_10_day',
              'ma_20_day',
              'ma_50_day',
              'ma_100_day',
              'ma_200_day',
              'ewma_5_day',
              'ewma_10_day',
              'ewma_12_day',
              'ewma_20_day',
              'ewma_26_day',
              'ewma_50_day',
              'ewma_100_day',
              'ewma_200_day',
              'diff_ma_5_day',
              'diff_ma_10_day',
              'diff_ma_20_day',
              'diff_ma_50_day',
              'diff_ma_100_day',
              'diff_ma_200_day',
              'diff_ewma_5_day',
              'diff_ewma_10_day',
              'diff_ewma_12_day',
              'diff_ewma_20_day',
              'diff_ewma_26_day',
              'diff_ewma_50_day',
              'diff_ewma_100_day',
              'diff_ewma_200_day',
              'pct_diff_ma_5_day',
              'pct_diff_ma_10_day',
              'pct_diff_ma_20_day',
              'pct_diff_ma_50_day',
              'pct_diff_ma_100_day',
              'pct_diff_ma_200_day',
              'pct_diff_ewma_5_day',
              'pct_diff_ewma_10_day',
              'pct_diff_ewma_12_day',
              'pct_diff_ewma_20_day',
              'pct_diff_ewma_26_day',
              'pct_diff_ewma_50_day',
              'pct_diff_ewma_100_day',
              'pct_diff_ewma_200_day',
              'pct_change',
              'moving_stdev_5_day',
              'moving_stdev_10_day',
              'moving_stdev_20_day',
              'moving_stdev_50_day',
              'moving_stdev_100_day',
              'moving_stdev_200_day',
              'moving_var_5_day',
              'moving_var_10_day',
              'moving_var_20_day',
              'moving_var_50_day',
              'moving_var_100_day',
              'moving_var_200_day',
              'momentum_5_day',
              'momentum_10_day',
              'momentum_20_day',
              'momentum_50_day',
              'momentum_100_day',
              'momentum_200_day',
              'macd',
              'macd_signal',
              'macd_histogram']


    raw_data =  np.array([
        [q.Date,
         q.Date.weekday(),
         q.AdjClose,
         q.Volume,
         q.Features.ma_5_day,
         q.Features.ma_10_day,
         q.Features.ma_20_day,
         q.Features.ma_50_day,
         q.Features.ma_100_day,
         q.Features.ma_200_day,
         q.Features.ewma_5_day,
         q.Features.ewma_10_day,
         q.Features.ewma_12_day,
         q.Features.ewma_20_day,
         q.Features.ewma_26_day,
         q.Features.ewma_50_day,
         q.Features.ewma_100_day,
         q.Features.ewma_200_day,
         q.Features.diff_ma_5_day,
         q.Features.diff_ma_10_day,
         q.Features.diff_ma_20_day,
         q.Features.diff_ma_50_day,
         q.Features.diff_ma_100_day,
         q.Features.diff_ma_200_day,
         q.Features.diff_ewma_5_day,
         q.Features.diff_ewma_10_day,
         q.Features.diff_ewma_12_day,
         q.Features.diff_ewma_20_day,
         q.Features.diff_ewma_26_day,
         q.Features.diff_ewma_50_day,
         q.Features.diff_ewma_100_day,
         q.Featuers.diff_ewma_200_day,
         q.Features.pct_diff_ma_5_day,
         q.Features.pct_diff_ma_10_day,
         q.Features.pct_diff_ma_20_day,
         q.Features.pct_diff_ma_50_day,
         q.Features.pct_diff_ma_100_day,
         q.Features.pct_diff_ma_200_day,
         q.Features.pct_diff_ewma_5_day,
         q.Features.pct_diff_ewma_10_day,
         q.Features.pct_diff_ewma_12_day,
         q.Features.pct_diff_ewma_20_day,
         q.Features.pct_diff_ewma_26_day,
         q.Features.pct_diff_ewma_50_day,
         q.Features.pct_diff_ewma_100_day,
         q.Features.pct_diff_ewma_200_day,
         q.Features.pct_change,
         q.Features.moving_stdev_5_day,
         q.Features.moving_stdev_10_day,
         q.Features.moving_stdev_20_day,
         q.Features.moving_stdev_50_day,
         q.Features.moving_stdev_100_day,
         q.Features.moving_stdev_200_day,
         q.Features.moving_var_5_day,
         q.Features.moving_var_10_day,
         q.Features.moving_var_20_day,
         q.Features.moving_var_50_day,
         q.Features.moving_var_100_day,
         q.Features.moving_var_200_day,
         q.Features.momentum_5_day,
         q.Features.momentum_10_day,
         q.Features.momentum_20_day,
         q.Features.momentum_50_day,
         q.Features.momentum_100_day,
         q.Features.momentum_200_day,
         q.Features.macd,
         q.Features.macd_signal,
         q.Features.macd_histogram] for q in quotes])

    data = DataFrame(raw_data[:,1:], index=raw_data[:,0], columns=col_names).dropna()

    return data

